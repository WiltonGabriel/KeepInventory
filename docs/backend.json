
{
  "entities": {
    "Block": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Bloco",
      "type": "object",
      "description": "Representa um bloco ou edifício físico dentro do sistema de inventário.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Identificador único para a entidade Bloco."
        },
        "name": {
          "type": "string",
          "description": "O nome do bloco."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Sector": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Setor",
      "type": "object",
      "description": "Representa um setor ou departamento dentro de um bloco.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Identificador único para a entidade Setor."
        },
        "name": {
          "type": "string",
          "description": "O nome do setor."
        },
        "blockId": {
          "type": "string",
          "description": "Referência ao Bloco. (Relação: Bloco 1:N Setor)"
        }
      },
      "required": [
        "id",
        "name",
        "blockId"
      ]
    },
    "Room": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Sala",
      "type": "object",
      "description": "Representa uma sala dentro de um setor.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Identificador único para a entidade Sala."
        },
        "name": {
          "type": "string",
          "description": "O nome da sala."
        },
        "sectorId": {
          "type": "string",
          "description": "Referência ao Setor. (Relação: Setor 1:N Sala)"
        }
      },
      "required": [
        "id",
        "name",
        "sectorId"
      ]
    },
    "Asset": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Patrimonio",
      "type": "object",
      "description": "Representa um bem ou item dentro de uma sala.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Identificador único para a entidade Patrimônio. Deve ser um ID alfanumérico refletindo a localização do ativo."
        },
        "name": {
          "type": "string",
          "description": "O nome do patrimônio."
        },
        "roomId": {
          "type": "string",
          "description": "Referência à Sala. (Relação: Sala 1:N Patrimonio)"
        }
      },
      "required": [
        "id",
        "name",
        "roomId"
      ]
    },
    "Movement": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Movimentacao",
      "type": "object",
      "description": "Representa um registro de movimentação ou histórico de alterações de um patrimônio.",
      "properties": {
        "assetId": {
          "type": "string",
          "description": "O ID do patrimônio que foi movido ou alterado."
        },
        "assetName": {
            "type": "string",
            "description": "O nome do patrimônio no momento da movimentação."
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "O carimbo de data/hora de quando a movimentação ocorreu."
        },
        "action": {
          "type": "string",
          "description": "O tipo de ação que ocorreu.",
          "enum": ["Criado", "Status Alterado", "Movido", "Nome Alterado"]
        },
        "from": {
          "type": "string",
          "description": "O estado ou localização antes da alteração."
        },
        "to": {
          "type": "string",
          "description": "O estado ou localização após a alteração."
        }
      },
      "required": ["assetId", "assetName", "timestamp", "action", "from", "to"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/blocos/{blocoId}",
        "definition": {
          "entityName": "Bloco",
          "schema": {
            "$ref": "#/backend/entities/Block"
          },
          "description": "Armazena dados do bloco. O 'blocoId' é um identificador único para cada bloco.",
          "params": [
            {
              "name": "blocoId",
              "description": "Identificador único para o bloco."
            }
          ]
        }
      },
      {
        "path": "/setores/{setorId}",
        "definition": {
          "entityName": "Setor",
          "schema": {
            "$ref": "#/backend/entities/Sector"
          },
          "description": "Armazena dados do setor. O 'setorId' é um identificador único para cada setor.",
          "params": [
            {
              "name": "setorId",
              "description": "Identificador único para o setor."
            }
          ]
        }
      },
      {
        "path": "/salas/{salaId}",
        "definition": {
          "entityName": "Sala",
          "schema": {
            "$ref": "#/backend/entities/Room"
          },
          "description": "Armazena dados da sala. O 'salaId' é um identificador único para cada sala.",
          "params": [
            {
              "name": "salaId",
              "description": "Identificador único para a sala."
            }
          ]
        }
      },
      {
        "path": "/patrimonios/{patrimonioId}",
        "definition": {
          "entityName": "Patrimonio",
          "schema": {
            "$ref": "#/backend/entities/Asset"
          },
          "description": "Armazena dados do patrimônio. O 'patrimonioId' é um identificador único para cada patrimônio.",
          "params": [
            {
              "name": "patrimonioId",
              "description": "Identificador único para o patrimônio."
            }
          ]
        }
      },
      {
        "path": "/patrimonios/{patrimonioId}/movimentacoes/{movimentacaoId}",
        "definition": {
          "entityName": "Movimentacao",
          "schema": {
            "$ref": "#/backend/entities/Movement"
          },
          "description": "Armazena o histórico de movimentações e alterações de um patrimônio específico como uma subcoleção aninhada.",
          "params": [
            {
              "name": "patrimonioId",
              "description": "O ID do patrimônio que está sendo rastreado."
            },
            {
              "name": "movimentacaoId",
              "description": "Identificador único para a entrada de log de movimentação."
            }
          ]
        }
      }
    ],
    "reasoning": "A estrutura do Firestore foi refatorada para ser mais segura e eficiente. As 'movimentacoes' não são mais uma coleção de nível superior, mas agora uma subcoleção aninhada dentro de cada documento 'patrimonio'. Essa estrutura hierárquica (/patrimonios/{patrimonioId}/movimentacoes/{movimentacaoId}) simplifica as regras de segurança, pois o acesso ao histórico de um patrimônio está inerentemente ligado ao acesso ao próprio patrimônio. Isso elimina a necessidade de consultas globais complexas na coleção de movimentações, que estava causando erros de permissão. Todas as outras entidades (Blocos, Setores, Salas, Patrimonios) permanecem em suas próprias coleções de nível superior para simplicidade e escalabilidade."
  }
}
