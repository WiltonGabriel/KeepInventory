
{
  "entities": {
    "Block": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Bloco",
      "type": "object",
      "description": "Representa um bloco ou edifício físico dentro do sistema de inventário.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Identificador único para a entidade Bloco."
        },
        "name": {
          "type": "string",
          "description": "O nome do bloco."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Sector": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Setor",
      "type": "object",
      "description": "Representa um setor ou departamento dentro de um bloco.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Identificador único para a entidade Setor."
        },
        "name": {
          "type": "string",
          "description": "O nome do setor."
        },
        "blockId": {
          "type": "string",
          "description": "Referência ao Bloco. (Relação: Bloco 1:N Setor)"
        }
      },
      "required": [
        "id",
        "name",
        "blockId"
      ]
    },
    "Room": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Sala",
      "type": "object",
      "description": "Representa uma sala dentro de um setor.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Identificador único para a entidade Sala."
        },
        "name": {
          "type": "string",
          "description": "O nome da sala."
        },
        "sectorId": {
          "type": "string",
          "description": "Referência ao Setor. (Relação: Setor 1:N Sala)"
        }
      },
      "required": [
        "id",
        "name",
        "sectorId"
      ]
    },
    "Asset": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Patrimonio",
      "type": "object",
      "description": "Representa um bem ou item dentro de uma sala.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Identificador único para a entidade Patrimônio. Deve ser um ID alfanumérico refletindo a localização do ativo."
        },
        "name": {
          "type": "string",
          "description": "O nome do patrimônio."
        },
        "roomId": {
          "type": "string",
          "description": "Referência à Sala. (Relação: Sala 1:N Patrimonio)"
        }
      },
      "required": [
        "id",
        "name",
        "roomId"
      ]
    },
    "Movement": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Movimentacao",
      "type": "object",
      "description": "Representa um registro de movimentação ou histórico de alterações de um patrimônio.",
      "properties": {
        "assetId": {
          "type": "string",
          "description": "O ID do patrimônio que foi movido ou alterado."
        },
        "assetName": {
            "type": "string",
            "description": "O nome do patrimônio no momento da movimentação."
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "O carimbo de data/hora de quando a movimentação ocorreu."
        },
        "action": {
          "type": "string",
          "description": "O tipo de ação que ocorreu.",
          "enum": ["Criado", "Status Alterado", "Movido", "Nome Alterado"]
        },
        "from": {
          "type": "string",
          "description": "O estado ou localização antes da alteração."
        },
        "to": {
          "type": "string",
          "description": "O estado ou localização após da alteração."
        }
      },
      "required": ["assetId", "assetName", "timestamp", "action", "from", "to"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/blocos/{blocoId}",
        "definition": {
          "entityName": "Bloco",
          "schema": {
            "$ref": "#/backend/entities/Block"
          },
          "description": "Armazena dados do bloco. O 'blocoId' é um identificador único para cada bloco.",
          "params": [
            {
              "name": "blocoId",
              "description": "Identificador único para o bloco."
            }
          ]
        }
      },
      {
        "path": "/setores/{setorId}",
        "definition": {
          "entityName": "Setor",
          "schema": {
            "$ref": "#/backend/entities/Sector"
          },
          "description": "Armazena dados do setor. O 'setorId' é um identificador único para cada setor.",
          "params": [
            {
              "name": "setorId",
              "description": "Identificador único para o setor."
            }
          ]
        }
      },
      {
        "path": "/salas/{salaId}",
        "definition": {
          "entityName": "Sala",
          "schema": {
            "$ref": "#/backend/entities/Room"
          },
          "description": "Armazena dados da sala. O 'salaId' é um identificador único para cada sala.",
          "params": [
            {
              "name": "salaId",
              "description": "Identificador único para a sala."
            }
          ]
        }
      },
      {
        "path": "/patrimonios/{patrimonioId}",
        "definition": {
          "entityName": "Patrimonio",
          "schema": {
            "$ref": "#/backend/entities/Asset"
          },
          "description": "Armazena dados do patrimônio. O 'patrimonioId' é um identificador único para cada patrimônio.",
          "params": [
            {
              "name": "patrimonioId",
              "description": "Identificador único para o patrimônio."
            }
          ]
        }
      },
      {
        "path": "/movimentacoes/{movimentacaoId}",
        "definition": {
          "entityName": "Movimentacao",
          "schema": {
            "$ref": "#/backend/entities/Movement"
          },
          "description": "Armazena o histórico de movimentações e alterações de todos os patrimônios. Cada documento é um log individual.",
          "params": [
            {
              "name": "movimentacaoId",
              "description": "Identificador único para a entrada de log de movimentação."
            }
          ]
        }
      }
    ],
    "reasoning": "A estrutura do Firestore foi refatorada para ser mais simples e robusta, eliminando a consulta collectionGroup que causava erros de permissão. A coleção 'movimentacoes' foi movida para o nível superior. Isso simplifica as consultas de leitura tanto para o log de atividades global no dashboard (uma consulta simples na coleção principal) quanto para o histórico de um item específico (uma consulta com um 'where' em 'patrimonioId'). As regras de segurança também são simplificadas, pois agora podemos definir permissões diretas na coleção 'movimentacoes'."
  }
}
