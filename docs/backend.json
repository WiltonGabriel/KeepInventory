
{
  "entities": {
    "Block": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Block",
      "type": "object",
      "description": "Represents a physical block or building within the inventory system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Block entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the block."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Sector": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Sector",
      "type": "object",
      "description": "Represents a sector or department within a block.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Sector entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the sector."
        },
        "blockId": {
          "type": "string",
          "description": "Reference to Block. (Relationship: Block 1:N Sector)"
        }
      },
      "required": [
        "id",
        "name",
        "blockId"
      ]
    },
    "Room": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Room",
      "type": "object",
      "description": "Represents a room within a sector.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Room entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the room."
        },
        "sectorId": {
          "type": "string",
          "description": "Reference to Sector. (Relationship: Sector 1:N Room)"
        }
      },
      "required": [
        "id",
        "name",
        "sectorId"
      ]
    },
    "Asset": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Asset",
      "type": "object",
      "description": "Represents an asset or item within a room.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Asset entity. This should be an alphanumeric ID reflecting the asset's location."
        },
        "name": {
          "type": "string",
          "description": "The name of the asset."
        },
        "salaId": {
          "type": "string",
          "description": "Reference to Room. (Relationship: Room 1:N Asset)"
        }
      },
      "required": [
        "id",
        "name",
        "salaId"
      ]
    },
    "Movement": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Movement",
      "type": "object",
      "description": "Represents a log of an asset's movement or change history.",
      "properties": {
        "assetId": {
          "type": "string",
          "description": "The ID of the asset that was moved or changed."
        },
        "assetName": {
            "type": "string",
            "description": "The name of the asset at the time of movement."
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of when the movement occurred."
        },
        "action": {
          "type": "string",
          "description": "The type of action that occurred.",
          "enum": ["Criado", "Status Alterado", "Movido", "Nome Alterado"]
        },
        "from": {
          "type": "string",
          "description": "The state or location before the change."
        },
        "to": {
          "type": "string",
          "description": "The state or location after the change."
        }
      },
      "required": ["assetId", "assetName", "timestamp", "action", "from", "to"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/blocks/{blockId}",
        "definition": {
          "entityName": "Block",
          "schema": {
            "$ref": "#/backend/entities/Block"
          },
          "description": "Stores block data. The 'blockId' is a unique identifier for each block.",
          "params": [
            {
              "name": "blockId",
              "description": "Unique identifier for the block."
            }
          ]
        }
      },
      {
        "path": "/sectors/{sectorId}",
        "definition": {
          "entityName": "Sector",
          "schema": {
            "$ref": "#/backend/entities/Sector"
          },
          "description": "Stores sector data. The 'sectorId' is a unique identifier for each sector.",
          "params": [
            {
              "name": "sectorId",
              "description": "Unique identifier for the sector."
            }
          ]
        }
      },
      {
        "path": "/rooms/{roomId}",
        "definition": {
          "entityName": "Room",
          "schema": {
            "$ref": "#/backend/entities/Room"
          },
          "description": "Stores room data. The 'roomId' is a unique identifier for each room.",
          "params": [
            {
              "name": "roomId",
              "description": "Unique identifier for the room."
            }
          ]
        }
      },
      {
        "path": "/assets/{assetId}",
        "definition": {
          "entityName": "Asset",
          "schema": {
            "$ref": "#/backend/entities/Asset"
          },
          "description": "Stores asset data. The 'assetId' is a unique identifier for each asset.",
          "params": [
            {
              "name": "assetId",
              "description": "Unique identifier for the asset."
            }
          ]
        }
      },
      {
        "path": "/assets/{assetId}/movements/{movementId}",
        "definition": {
          "entityName": "Movement",
          "schema": {
            "$ref": "#/backend/entities/Movement"
          },
          "description": "Stores the history of a specific asset's movements and changes as a nested subcollection.",
          "params": [
            {
              "name": "assetId",
              "description": "The ID of the asset being tracked."
            },
            {
              "name": "movementId",
              "description": "Unique identifier for the movement log entry."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is refactored to be more secure and efficient. The 'movements' are no longer a top-level collection but are now a subcollection nested within each 'asset' document. This hierarchical structure (/assets/{assetId}/movements/{movementId}) simplifies security rules, as access to an asset's history is inherently tied to access to the asset itself. This eliminates the need for complex global queries on the movements collection, which was causing permission errors. All other entities (Blocks, Sectors, Rooms, Assets) remain in their own top-level collections for simplicity and scalability."
  }
}
